{% extends "base.html" %}
{% block content %}
<div class="min-h-screen bg-gray-900 text-gray-100 py-10">
  <div class="max-w-5xl mx-auto px-4 space-y-8">

    <!-- Профиль и аватар -->
    <div class="flex items-center gap-6 pb-6 border-b border-gray-800">
      <div class="relative group">
        {% if user.is_authenticated and user.avatar_url %}
          <img src="{{ user.avatar_url }}" alt="Avatar"
               class="w-28 h-28 rounded-full object-cover border-2 border-gray-800 shadow-sm">
        {% else %}
          <div class="w-28 h-28 rounded-full flex items-center justify-center bg-gray-800 text-xl font-semibold border-2 border-gray-700">
            {{ (user.username[:1] if user.is_authenticated else 'U') | upper }}
          </div>
        {% endif %}

        {% if user.is_authenticated %}
        <form action="{{ url_for('account.upload_avatar') }}" method="post" enctype="multipart/form-data"
              class="absolute inset-0 flex items-center justify-center bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity rounded-full">
          <label class="cursor-pointer text-xs text-white bg-indigo-600 px-2 py-1 rounded-md">
            Change
            <input type="file" name="avatar" class="hidden" onchange="this.form.submit()">
          </label>
        </form>
        {% endif %}
      </div>

      <div class="flex-1">
        <h1 class="text-2xl font-semibold">{{ user.username if user.is_authenticated else "Guest" }}</h1>
        <p class="text-sm text-gray-400 mt-1">{{ user.email if user.is_authenticated and user.email else "Email not provided" }}</p>
      </div>
    </div>

    <!-- Настройки и информация -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

      <!-- Основная колонка -->
      <div class="lg:col-span-2 space-y-6">


        <!-- Appearance Settings -->
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
          <h2 class="text-lg font-medium mb-4">Appearance Settings</h2>
          <form id="appearance-form" class="space-y-4">
              <!-- Theme -->
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Theme</span>
                <select name="theme" id="theme-select" class="bg-gray-900 border border-gray-700 rounded px-3 py-1 text-gray-200">
                  <option value="dark" selected>Dark</option>
                  <option value="light">Light</option>
                  <option value="auto">Auto</option>
                </select>
              </div>
              <!-- Font Size -->
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Font Size</span>
                <select name="font_size" id="font-size-select" class="bg-gray-900 border border-gray-700 rounded px-3 py-1 text-gray-200">
                  <option value="small">Small</option>
                  <option value="medium" selected>Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>
              <!-- Density -->
              <div class="flex items-center justify-between">
                <span class="text-gray-300">Interface Density</span>
                <select name="density" id="density-select" class="bg-gray-900 border border-gray-700 rounded px-3 py-1 text-gray-200">
                  <option value="comfortable" selected>Comfortable</option>
                  <option value="compact">Compact</option>
                </select>
              </div>
              <div class="pt-3 text-right">
                <button type="submit" class="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-500 transition">
                  Save Changes
                </button>
              </div>
              <div>
                  not work for now
              </div>
            </form>

            <script>
            document.getElementById('appearance-form').addEventListener('submit', function(e) {
              e.preventDefault();

              const theme = document.getElementById('theme-select').value;
              const fontSize = document.getElementById('font-size-select').value;
              const density = document.getElementById('density-select').value;

              // Применяем сразу без перезагрузки
              applyAppearance(theme, fontSize, density);

              // Отправляем на сервер
              fetch("{{ url_for('account.update_appearance') }}", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ theme, font_size: fontSize, density })
              }).then(res => res.json())
                .then(data => {
                  if (data.status === "ok") {
                    console.log("Appearance updated");
                  }
                });
            });

            function applyAppearance(theme, fontSize, density) {
              // Тема
              if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                document.body.style.backgroundColor = '#111827'; // bg-gray-900
              } else if (theme === 'light') {
                document.documentElement.classList.remove('dark');
                document.body.style.backgroundColor = '#ffffff';
              }

              // Размер шрифта
              document.documentElement.style.fontSize =
                fontSize === 'small' ? '14px' :
                fontSize === 'large' ? '18px' : '16px';

              // Плотность интерфейса
              document.body.dataset.density = density; // Можно использовать в CSS
            }
            </script>

            </div>
          </form>
        </div>

        <!-- Contact Info -->
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
          <h2 class="text-lg font-medium mb-3">Contact Information</h2>
          <ul class="space-y-2 text-gray-300">
            <li><span class="text-gray-400">Email:</span> {{ user.email if user.is_authenticated and user.email else "—" }}</li>
            <li><span class="text-gray-400">Role:</span> {{ user.role if user.is_authenticated and user.role else "User" }}</li>
            <li><span class="text-gray-400">Joined:</span> {{ user.created_at.strftime('%d.%m.%Y') if user.is_authenticated and user.created_at else "—" }}</li>
          </ul>
        </div>

      </div>

      <!-- Правая колонка -->
      <aside class="space-y-6">

        <!-- Recent Activity -->
        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700">
          <h3 class="text-md font-medium mb-2">Recent Activity</h3>
          <ul class="text-sm text-gray-300 space-y-2">
            {% if recent_activity %}
              {% for act in recent_activity %}
                <li class="flex justify-between items-center">
                  <span>{{ act.icon }} {{ act.text }}</span>
                  <span class="text-xs text-gray-500">
                    {{ act.date.strftime('%d.%m.%Y %H:%M') if act.date else '' }}
                  </span>
                </li>
              {% endfor %}
            {% else %}
              <li class="text-gray-400">No activity</li>
            {% endif %}
          </ul>
        </div>
      </aside>
    </div>
  </div>
</div>
{% endblock %}
